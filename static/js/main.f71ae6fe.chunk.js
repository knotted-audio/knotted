(this.webpackJsonpknotted=this.webpackJsonpknotted||[]).push([[0],{32:function(e,t,n){var i=n(30),a=["draw"];e.exports=function(){var e=new Worker(n.p+"68a85f8416c7075e19df.worker.js",{name:"[hash].worker.js"});return i(e,a),e}},34:function(e,t,n){var i=n(30),a=["sliceBuffer"];e.exports=function(){var e=new Worker(n.p+"0936f4e41e22ec92ee4e.worker.js",{name:"[hash].worker.js"});return i(e,a),e}},39:function(e,t,n){e.exports=n(53)},44:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(19),r=n.n(o),c=(n(44),n(5)),s=n.n(c),u=n(11),l=n(4),h=n(6),p=n(55),d=n(36),f=n(56),m=n(32),v=n.n(m),g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.buffer,n=void 0===t?null:t,o=e.width,r=void 0===o?500:o,c=e.height,s=void 0===c?100:c,u=e.zoom,l=void 0===u?1:u,h=e.color,p=void 0===h?"black":h,d=e.onDone,f=void 0===d?null:d,m=e.pixelRatio,g=void 0===m?window.devicePixelRatio:m,b=Object(i.useRef)(null),y=new v.a;Object(i.useLayoutEffect)((function(){var e=r*l,t=s/2,i=n.getChannelData(0),a=Math.ceil(i.length/e),o=b.current.transferControlToOffscreen();y.postMessage({type:"waveform-render",payload:{canvas:o,width:r,step:a,middle:t,data:i,fillStyle:p}},[o]),f&&(y.onmessage=function(e){"waveform-rendered"===e.data.type&&f()},f())}));var E=Math.floor(g*r*l),O=Math.floor(g*s),T={width:r*l,height:s};return a.a.createElement("canvas",{ref:b,width:E,height:O,style:T})},b=Object(i.memo)((function(e){return a.a.createElement(g,e)}),(function(e,t){return e.id===t.id&&e.width===t.width&&e.height===t.height&&e.color===t.color})),y=n(58),E=n(33),O=n.n(E),T=function(e){return{type:"@GRID/CREATE_LOOP",payload:{buffer:e,color:O()(),id:Object(y.a)()}}},A="@GRID/TOGGLE_PLAY",w=function(){return{type:A}},x=function(e){return{type:"@GRID/SET_LOOP_LENGTH",payload:{loopLength:e}}};function D(e){var t=e.id,n=e.index,i=(e.length,e.active),o=e.color,r=e.buffer,c=e.width,s=e.height,u=e.tempo,h=e.setActiveLoopA,p=60/u,d=Math.round(r.duration/p),m=Object(f.a)({item:{id:t,type:"LOOP"}}),v=Object(l.a)(m,2),g=v[0].opacity,y=v[1];return a.a.createElement("div",{ref:y,className:"Loop ".concat(i?"active":""),style:{opacity:g,height:s,width:c,paddingTop:20},onClick:function(){return h(t)}},a.a.createElement(b,{id:t,width:c,height:s-20,color:o,buffer:r}),a.a.createElement("div",null,"Loop ",n," ","//"," ",d," beats"))}var j=Object(h.b)((function(e){return{loops:e.loop.loops,activeLoop:e.grid.activeLoop,tempo:e.grid.tempo}}),(function(e){return{createLoopA:function(t){return e(T(t))},setActiveLoopA:function(t){return e(function(e){return{type:"@GRID/SET_ACTIVE_LOOP",payload:{loopId:e}}}(t))}}}))((function(e){var t=e.loops,n=e.width,i=e.tempo,o=e.activeLoop,r=(e.createLoopA,e.setActiveLoopA);return a.a.createElement("div",{className:"LoopPanel",style:{width:n}},t.map((function(e,t){return a.a.createElement(D,Object.assign({key:e.id,index:t,setActiveLoopA:r,active:o===e.id},e,{tempo:i,width:n-20,height:75}))})))})),I=n(2),S=n(57);function R(e){e.id;var t=e.color,n=e.soft,i=e.numMarkers,o=n?.3:1;return a.a.createElement("div",{className:"GridLoopMarker ".concat(i>4?"half":""),style:{backgroundColor:t,opacity:o}})}function L(e){var t=e.beat,n=(e.barBeat,e.loopTriggers),i=e.loopTails,o=(e.activeLoop,e.setGridElemA),r=e.addLoopInstanceA,c=e.onClick,s=Object(S.a)({accept:["LOOP"],drop:function(e){return r(t,e.id)}})[1],u=n.length+i.length;return a.a.createElement("div",{ref:function(e){o(t,e),s(e)},className:"Grid",onClick:c},n.map((function(e){return a.a.createElement(R,Object.assign({key:e.instanceId},e,{numMarkers:u}))})),i.map((function(e){return a.a.createElement(R,Object.assign({key:e.instanceId},e,{soft:!0,numMarkers:u}))})))}var M=Object(h.b)((function(e){var t=e.grid.tempo,n=e.grid.grid.map((function(n){return n.loopTriggers.map((function(i){var a=i.id,o=i.instanceId,r=e.loop.loops.find((function(e){return e.id===a})),c=60/t,s=Math.round(r.buffer.duration/c),u=[n.beat,(n.beat+s-1)%e.grid.grid.length];return Object(I.a)({range:u,instanceId:o},r)}))})).flat(),i=e.grid.grid.map((function(e){var t=n.filter((function(t){return t.range[0]===e.beat})),i=n.filter((function(t){return n=t.range[0]+1,i=t.range[1],(a=e.beat)>=n&&a<=i||t.range[0]>t.range[1]&&e.beat>t.range[0]||t.range[0]>t.range[1]&&e.beat<t.range[1];var n,i,a}));return Object(I.a)(Object(I.a)({},e),{},{loopTriggers:t,loopTails:i})}));return Object(I.a)(Object(I.a)({},e.grid),{},{grid:i})}),(function(e){return{setGridElemA:function(t,n){return e(function(e,t){return{type:"@GRID/SET_GRID_ELEM",payload:{index:e,domElem:t}}}(t,n))},addLoopInstanceA:function(t,n){return e(function(e,t){return{type:"@GRID/ADD_LOOP_INSTANCE",payload:{beat:e,loopId:t,instanceId:Object(y.a)()}}}(t,n))}}}))((function(e){var t=e.activeLoop,n=e.width,i=e.grid,o=(e.beats,e.beatsPerBar,e.setGridElemA),r=e.addLoopInstanceA;return a.a.createElement("div",{className:"GridPanel",style:{width:n,height:n}},i.map((function(e){return a.a.createElement(L,Object.assign({key:e.beat},e,{setGridElemA:o,addLoopInstanceA:r,onClick:function(){return t&&r(e.beat,t)}}))})))})),G=n(12),k={loops:[],loopsInUse:[],activeMidiTrack:0,loopStartTime:0,loopDuration:0,midiCounter:0},C=Object(G.a)(Array(3).keys()).map((function(){return{muted:!1,timeline:{}}}));function _(){return C}var P=Object(h.b)((function(e){var t=e.grid,n=t.tempo,i=t.quantizationMidi,a=t.beats,o=e.loop;return{tempo:n,quantizationMidi:i,beats:a,loopDuration:o.loopDuration,loopStartTime:o.loopStartTime,secondsPerBeat:60/n,midiCounter:o.midiCounter,midiTracks:_()}}),(function(e){return{}}))((function(e){e.tempo,e.quantizationMidi,e.beats;var t=e.loopDuration,n=(e.loopStartTime,e.secondsPerBeat,e.midiCounter,e.width),i=e.midiTracks;return a.a.createElement("div",{className:"MidiPanel",style:{width:n}},i.map((function(e){e.muted;var n=e.timeline,i=Object.keys(n).reduce((function(e,i){var a=i/t*100;return n[i].forEach((function(t){var n=e[t.name]||[];n.push(a),e[t.name]=n})),e}),{});return a.a.createElement("div",{className:"MidiTrack"},Object.keys(i).map((function(e){return a.a.createElement("div",{className:"MidiSample"},a.a.createElement("span",{style:{width:"20%"}},e),i[e].map((function(e){return a.a.createElement("span",{className:"MidiNote",style:{left:"".concat(.8*e+20,"%")}})})))})))})))})),B=n(10),V=n.n(B),N=n(34),q=(new(n.n(N).a),null);function F(){return q||(q=new AudioContext({latencyHint:0}))}function W(e,t,n){var i,a=new MediaRecorder(e);return a.start(1e3*n),new Promise((function(e){return a.ondataavailable=function(n){i=t.currentTime,"recording"===a.state&&a.stop(),e(n.data)}})).then((function(e){return e.arrayBuffer()})).then((function(e){return new Promise((function(n,a){return t.decodeAudioData(e,(function(e){return n([e,i])}),a)}))}))}function z(e){return e.reduce((function(e,t){return e+Math.abs(t)}),0)}function U(e){return K.apply(this,arguments)}function K(){return(K=Object(u.a)(s.a.mark((function e(t){var n,i,a,o,r,c,u,h,p,d,f,m,v,g,b,y,E;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=F(),(i=n.createOscillator()).frequency.value=440,i.connect(n.destination),a=n.currentTime,o=W(t,n,4),i.start(a+2),i.stop(a+3),e.next=10,o;case 10:r=e.sent,c=Object(l.a)(r,2),u=c[0],h=c[1],p=u.getChannelData(0),d=u.sampleRate,f=1e3*(h-4),m=p.slice(0,d),v=z(m)/d,g=20*Math.log10(v)+24,b=Math.pow(10,g/20),y=null,E=d;case 23:if(!(E<4*d)){e.next=30;break}if(!(p[E]>Math.abs(b))){e.next=27;break}return y=Math.round(Math.abs(2e3-1e3*E/d)),e.abrupt("break",30);case 27:E++,e.next=23;break;case 30:return window.localStorage.setItem("Knotted-Latency",y),window.localStorage.setItem("Knotted-RecordingOffset",f),e.abrupt("return",y);case 33:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var X=Object(h.b)((function(e){return{playing:e.grid.playing,tempo:e.grid.tempo,metronome:e.grid.metronome,gain:e.grid.gain,loopLength:e.grid.loopLength,mediaStream:e.grid.mediaStream,inputDeviceList:e.grid.inputDeviceList,midiDeviceList:e.grid.midiDeviceList,activeInputDevice:e.grid.activeInputDevice}}),(function(e){return{togglePlayA:function(){return e(w())},toggleMetronomeA:function(){return e({type:"@GRID/TOGGLE_METRONOME"})},setTempoA:function(t){return e(function(e){return{type:"@GRID/SET_TEMPO",payload:{tempo:e}}}(t))},setGainA:function(t){return e(function(e){return{type:"@GRID/SET_GAIN",payload:{gain:e}}}(t))},setInputDevicesA:function(t){return e(function(e){return{type:"@GRID/SET_INPUT_DEVICES",payload:{devices:e}}}(t))},setMidiDevicesA:function(t){return e(function(e){return{type:"@GRID/SET_MIDI_DEVICES",payload:{devices:e}}}(t))},setMediaStreamA:function(t){return e(function(e){return{type:"@GRID/SET_MEDIA_STREAM",payload:{stream:e}}}(t))},setLoopLengthA:function(t){return e(x(t))}}}))((function(e){var t=e.playing,n=e.loopLength,o=e.gain,r=e.width,c=e.tempo,s=e.metronome,u=e.mediaStream,l=e.midiDeviceList,h=e.activeInputDevice,p=e.inputDeviceList,d=e.togglePlayA,f=e.setGainA,m=e.setTempoA,v=e.toggleMetronomeA,g=e.setInputDevicesA,b=e.setMidiDevicesA,y=e.setMediaStreamA,E=e.setLoopLengthA;Object(i.useEffect)((function(){var e;(e=h,navigator.mediaDevices.getUserMedia({audio:{AUDIO_CONFIG:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0},deviceId:e}})).then((function(e){return y(e)}))}),[y,h]),Object(i.useEffect)((function(){function e(e){for(var t=[],n=e.inputs.values(),i=n.next();i&&!i.done;i=n.next())t.push(i.value);b(t)}navigator.requestMIDIAccess().then((function(t){t.addEventListener("statechange",(function(t){return e(t.target)})),e(t)}),(function(e){return console.log("Something went wrong",e)}))}),[b]),Object(i.useEffect)((function(){u&&navigator.mediaDevices.enumerateDevices().then((function(e){return g(e)}))}),[u,g]);var O=p.reduce((function(e,t){return"audioinput"===t.kind&&(e[t.label]=t.deviceId),e}),{}),T=l.reduce((function(e,t){return"input"===t.type&&(e[t.name]=t.id),e}),{});return a.a.createElement(V.a,{theme:"light",width:.6*r,onChange:function(e,t){"tempo"===e&&m(t),"metronome"===e&&v(),"gain"===e&&f(t),"loop length"===e&&12!==t&&E(t),"play"===e&&d()},state:{latency:!1,tempo:c,gain:o,metronome:s,"loop length":n,play:t}},a.a.createElement(B.Custom,{label:"play",Comp:function(e){var t=e.value;e.onChange;return a.a.createElement("button",{className:"PlayButton ".concat(t?"pause":""),onClick:d})}}),a.a.createElement(B.Checkbox,{label:"metronome"}),a.a.createElement(B.Range,{label:"loop length",min:4,max:16,step:4}),a.a.createElement(B.Range,{label:"tempo",min:40,max:260,step:1}),a.a.createElement(B.Range,{label:"gain",min:0,max:1}),a.a.createElement(B.Select,{label:"input",options:O}),a.a.createElement(B.Select,{label:"inputmidi",options:T}))}));n(52);var H=Object(h.b)((function(e){return{playing:e.grid.playing,mediaStream:e.grid.mediaStream}}),(function(e){return{togglePlayA:function(){return e(w())}}}))((function(e){var t=e.playing,n=e.mediaStream,o=e.togglePlayA,r=function(){var e="object"===typeof window,t=Object(i.useCallback)((function(){return{width:e?window.innerWidth:void 0,height:e?window.innerHeight:void 0}}),[e]),n=Object(i.useState)(t),a=Object(l.a)(n,2),o=a[0],r=a[1];return Object(i.useEffect)((function(){if(!e)return!1;function n(){r(t())}return window.addEventListener("resize",n),function(){return window.removeEventListener("resize",n)}}),[t,e]),o}(),c=r.width,h=r.height,f=Math.min(.35*c,h-120),m=.5*(c-f),v=Object(i.useState)(!1),g=Object(l.a)(v,2),b=g[0],y=g[1],E=function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&o(),y(!0),e.next=4,U(n);case 4:y(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=window.localStorage.getItem("Knotted-Latency");return a.a.createElement("div",{className:"Wrapper"},b?null:a.a.createElement("header",{className:"Controls"},a.a.createElement("h2",null,"Knotted.live"),a.a.createElement("div",null,a.a.createElement(X,{width:Math.min(c,650)})),a.a.createElement("button",{className:"MainButton",onClick:E},"Configure Latency (",O," ms)")),a.a.createElement("div",{className:"App"},b?a.a.createElement("h2",null,"Testing... Please wait"):a.a.createElement(p.a,{backend:d.a},a.a.createElement(M,{width:f,activeBeat:0}),a.a.createElement(j,{width:m}),a.a.createElement(P,{width:m}))),a.a.createElement("footer",null,"By ",a.a.createElement("a",{href:"https://jtfell.com"},"jtfell")))})),J=n(9);window.gridElems=[];var Q,Y,$={beatsPerBar:4,beats:16,playing:!1,recordingMidi:!0,metronome:!0,tempo:136.55,loopLength:8,quantizationBeats:4,quantizationMidi:.25,gain:.2,activeLoop:null,activeMidiDevice:null,midiDeviceList:[],activeInputDevice:null,inputDeviceList:[],mediaStream:null,grid:(Q=16,Y=4,Object(G.a)(Array(Q).keys()).map((function(e){return{beat:e+1,barBeat:(e+1)%Y,loopTriggers:[]}})))};for(var Z=Object(J.c)({loop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"@GRID/RECORD_MIDI_NOTE":var n=t.payload,i=n.triggerTime,a=n.engine,o=C[e.activeMidiTrack].timeline,r=(i-e.loopStartTime)%e.loopDuration,c=o[r]||[];return c.push(a),o[r]=c,Object(I.a)(Object(I.a)({},e),{},{midiCounter:e.midiCounter+1});case"@GRID/SET_LOOP_START_TIME":return Object(I.a)(Object(I.a)({},e),{},{loopStartTime:t.payload.loopStartTime,loopDuration:t.payload.loopDuration});case"@GRID/CREATE_LOOP":var s=Object(G.a)(e.loops),u=Date.now();if(s.length<3)return s=[].concat(Object(G.a)(s),[Object(I.a)(Object(I.a)({},t.payload),{},{createdAt:u})]),Object(I.a)(Object(I.a)({},e),{},{loops:s});var h=s.reduce((function(t,n,i){var a=Object(l.a)(t,2),o=a[0],r=a[1];return e.loopsInUse.indexOf(n.id)>-1?[o,r]:null===o||o.createdAt>n.createdAt?[n,i]:[o,r]}),[null,-1]),p=Object(l.a)(h,2),d=(p[0],p[1]);return d>-1?s[d]=Object(I.a)(Object(I.a)({},t.payload),{},{createdAt:u}):console.log("No space!"),Object(I.a)(Object(I.a)({},e),{},{loops:s});case"@GRID/ADD_LOOP_INSTANCE":return Object(I.a)(Object(I.a)({},e),{},{loopsInUse:[].concat(Object(G.a)(e.loopsInUse),[t.payload.loopId])});default:return e}},grid:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"@GRID/SET_GRID_ELEM":return window.gridElems[t.payload.index-1]=t.payload.domElem,e;case"@GRID/ADD_LOOP_INSTANCE":var n=Object(G.a)(e.grid),i=n[t.payload.beat-1];return i.loopTriggers.push({id:t.payload.loopId,instanceId:t.payload.instanceId}),Object(I.a)(Object(I.a)({},e),{},{grid:n});case"@GRID/TOGGLE_METRONOME":return Object(I.a)(Object(I.a)({},e),{},{metronome:!e.metronome});case A:return Object(I.a)(Object(I.a)({},e),{},{playing:!e.playing});case"@GRID/SET_ACTIVE_LOOP":return Object(I.a)(Object(I.a)({},e),{},{activeLoop:t.payload.loopId});case"@GRID/SET_GAIN":return Object(I.a)(Object(I.a)({},e),{},{gain:t.payload.gain});case"@GRID/SET_LOOP_LENGTH":return Object(I.a)(Object(I.a)({},e),{},{loopLength:t.payload.loopLength});case"@GRID/SET_MIDI_DEVICES":return Object(I.a)(Object(I.a)({},e),{},{midiDeviceList:t.payload.devices});case"@GRID/SET_INPUT_DEVICES":return Object(I.a)(Object(I.a)({},e),{},{inputDeviceList:t.payload.devices});case"@GRID/SET_MEDIA_STREAM":return Object(I.a)(Object(I.a)({},e),{},{mediaStream:t.payload.stream});case"@GRID/SET_TEMPO":return Object(I.a)(Object(I.a)({},e),{},{tempo:t.payload.tempo});default:return e}}}),ee=function(e){return function(t){var n,i,a=null,o=function t(){var o=F(),r=e.getState(),c=r.grid,h=c.mediaStream,p=(c.quantizationMidi,c.playing),d=c.metronome,f=c.tempo,m=c.grid,v=c.gain,g=c.beats,b=c.beatsPerBar,y=c.loopLength,E=r.loop,O=E.loops,A=E.loopDuration,w=E.loopStartTime,x=60/f;try{var D=o.currentTime;if(p&&n<D+.1){if(function(e,t,n,i,a,o,r){e[n%i].loopTriggers.map((function(e){var n=e.id;return t.find((function(e){return e.id===n}))})).forEach((function(e){var t=e.buffer,n=a.createBufferSource();n.buffer=t;var i=a.createGain();i.gain.setValueAtTime(o,a.currentTime),n.connect(i).connect(a.destination),n.start(r)}))}(m,O,i,g,o,v,n),function(e,t,n,i,a,o,r,c){for(var s=function(t){var i=e[t],a=i.muted,s=i.timeline,u=Object.keys(s);if(a||0===u.length)return"continue";var l=Math.floor((o-c)/r);u.filter((function(e){var t=parseFloat(e)+c+r*l,i=parseFloat(e)+c+r*(l+1);return t>o+n&&t<=o+2*n||i>o+n&&i<=o+2*n})).forEach((function(e){var t=F(),i=s[e],a=parseFloat(e)+c+r*l,u=(o+n-a)/n,h=o+n;u<.125||(h+=u<3/8?.25*n:u<5/8?.5*n:u<7/8?.75*n:1*n),i.forEach((function(e){new e(t).trigger(h)}))}))},u=0;u<e.length;u++)s(u)}(_(),0,x,0,0,n,A,w),i%y===0)(function(e,t,n,i){var a=i-t.currentTime+.2,o=window.localStorage.getItem("Knotted-Latency");return W(e,t,a).then(function(){var e=Object(u.a)(s.a.mark((function e(a){var r,c,u,h,p,d,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=Object(l.a)(a,2),c=r[0],r[1],u=c.sampleRate,h=t.createBuffer(1,(i-n)*u,u),p=c.getChannelData(0),d=h.getChannelData(0),f=0;f<(i-n)*u;f++)d[f]=p[f+Math.floor(o*u/1e3)];return e.abrupt("return",h);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})(h,o,n,n+y*x).then((function(t){return e.dispatch(T(t))}));d&&function(e,t,n,i,a){var o=e.createOscillator();o.connect(e.destination),o.frequency.value=t%i===0?880:t%a===0?440:220,o.start(n),o.stop(n+.01)}(o,i,n,g,b),i+=1,i%=g,n+=x}}finally{a=setTimeout(t,20)}};return function(r){t(r);var c=e.getState().grid,s=60/c.tempo*c.loopLength;if(r.type===A&&e.getState().grid.playing){var u=window.audioCtx||new AudioContext;window.audioCtx=u,i=0,n=u.currentTime+.1,e.dispatch(function(e,t){return{type:"@GRID/SET_LOOP_START_TIME",payload:{loopStartTime:e,loopDuration:t}}}(n,s)),a=setTimeout(o,20)}else r.type===A&&a&&(clearTimeout(a),i=0)}}},te=function(e){return function(t){var n,i,a=null,o=function t(){var o=F(),r=e.getState().grid,c=r.playing,s=r.tempo,u=r.beats,l=60/s;try{var h=o.currentTime;if(c&&n<h+-.05){var p=i-1;-1===p&&(p=u-1),window.gridElems[p].classList.remove("active"),window.gridElems[i].classList.add("active"),i+=1,i%=u,n+=l}}finally{a=requestAnimationFrame(t)}};return function(r){if(t(r),r.type===A&&e.getState().grid.playing){var c=window.audioCtx||new AudioContext;window.audioCtx=c,i=0,n=c.currentTime+.1,a=requestAnimationFrame(o)}else r.type===A&&a&&(window.gridElems.forEach((function(e){return e.classList.remove("active")})),cancelAnimationFrame(a))}}},ne=n(35),ie=n(7),ae=n(8),oe=function(){function e(t){var n=this;Object(ie.a)(this,e),this.setTone=function(e){n.tone=e},this.setVolume=function(e){n.volume=e},this.setFXAmount=function(e){n.fxAmount=e},this.ctx=t,this.tone=167.1,this.decay=.5,this.volume=1,this.fxAmount=0,this.hasSetup=!1}return Object(ae.a)(e,[{key:"makeDistortionCurve",value:function(e){for(var t,n=e/4,i=new Float32Array(44100),a=Math.PI/180,o=0;o<44100;++o)t=2*o/44100-1,i[o]=(3+n)*t*20*a/(Math.PI+n*Math.abs(t));return i}},{key:"setup",value:function(){this.osc=this.ctx.createOscillator(),this.osc.type="sine",this.gain=this.ctx.createGain(),this.distortion=this.ctx.createWaveShaper(),this.distortion.curve=this.makeDistortionCurve(this.fxAmount),this.osc.connect(this.gain),this.gain.connect(this.distortion),this.distortion.connect(this.ctx.destination),this.hasSetup=!0}},{key:"trigger",value:function(e){0!==this.volume&&(this.hasSetup||this.setup(),this.osc.frequency.setValueAtTime(this.tone,e+.001),this.gain.gain.linearRampToValueAtTime(this.volume,e+.1),this.osc.frequency.exponentialRampToValueAtTime(1,e+this.decay),this.gain.gain.exponentialRampToValueAtTime(.01*this.volume,e+this.decay),this.gain.gain.linearRampToValueAtTime(0,e+this.decay+.1),this.osc.start(e),this.osc.stop(e+this.decay+.1))}}]),e}(),re=function(){function e(t){var n=this;Object(ie.a)(this,e),this.setTone=function(e){n.tone=e},this.setVolume=function(e){n.volume=e},this.setFXAmount=function(e){n.fxAmount=e},this.ctx=t,this.tone=100,this.decay=.2,this.volume=1,this.hasSetup=!1}return Object(ae.a)(e,[{key:"setup",value:function(){this.noise=this.ctx.createBufferSource(),this.noise.buffer=this.noiseBuffer();var e=this.ctx.createBiquadFilter();e.type="highpass",e.frequency.value=1e3,this.noise.connect(e),this.noiseEnvelope=this.ctx.createGain(),e.connect(this.noiseEnvelope),this.noiseEnvelope.connect(this.ctx.destination),this.osc=this.ctx.createOscillator(),this.osc.type="triangle",this.oscEnvelope=this.ctx.createGain(),this.osc.connect(this.oscEnvelope),this.oscEnvelope.connect(this.ctx.destination),this.hasSetup=!0}},{key:"noiseBuffer",value:function(){for(var e=this.ctx.sampleRate,t=this.ctx.createBuffer(1,e,this.ctx.sampleRate),n=t.getChannelData(0),i=0;i<e;i++)n[i]=2*Math.random()-1;return t}},{key:"trigger",value:function(e){0!==this.volume&&(this.hasSetup||this.setup(),this.noiseEnvelope.gain.setValueAtTime(this.volume,e),this.noiseEnvelope.gain.exponentialRampToValueAtTime(.01,e+this.decay),this.osc.frequency.setValueAtTime(this.tone,e),this.oscEnvelope.gain.setValueAtTime(.7*this.volume,e),this.oscEnvelope.gain.exponentialRampToValueAtTime(.01*this.volume,e+this.decay/2),this.osc.start(e),this.noise.start(e),this.osc.stop(e+this.decay),this.noise.stop(e+this.decay))}}]),e}(),ce=function(){function e(t){var n=this;Object(ie.a)(this,e),this.setTone=function(e){n.tone=e},this.setVolume=function(e){n.volume=e},this.setFXAmount=function(e){n.fxAmount=e},this.ctx=t,this.ratios=[1,1.342,1.2312,1.6532,1.9523,2.1523],this.tone=130.81,this.decay=.5,this.volume=1,this.fxAmount=0,this.hasSetup=!1}return Object(ae.a)(e,[{key:"setup",value:function(){this.oscEnvelope=this.ctx.createGain(),this.bndPass=this.ctx.createBiquadFilter(),this.bndPass.type="bandpass",this.bndPass.frequency.value=2e4,this.bndPass.Q.value=.2,this.hipass=this.ctx.createBiquadFilter(),this.hipass.type="highpass",this.hipass.frequency.value=5e3,this.panner=this.ctx.createStereoPanner(),this.bndPass.connect(this.hipass),this.hipass.connect(this.oscEnvelope),this.oscEnvelope.connect(this.panner),this.panner.connect(this.ctx.destination),this.hasSetup=!0}},{key:"trigger",value:function(e){var t=this;0!==this.volume&&(this.hasSetup||this.setup(),this.panner.pan.value=Math.cos(4*e)*this.fxAmount/100,this.ratios.forEach((function(n){var i=t.ctx.createOscillator();i.type="square",i.frequency.value=t.tone*n,i.connect(t.bndPass),i.start(e),i.stop(e+t.decay)})),this.oscEnvelope.gain.setValueAtTime(1e-5*this.volume,e),this.oscEnvelope.gain.exponentialRampToValueAtTime(1*this.volume,e+.067*this.decay),this.oscEnvelope.gain.exponentialRampToValueAtTime(.3*this.volume,e+.1*this.decay),this.oscEnvelope.gain.exponentialRampToValueAtTime(1e-5*this.volume,e+this.decay))}}]),e}(),se=function(){function e(t){var n=this;Object(ie.a)(this,e),this.trigger=function(e){0!==n.volume&&(n.hasSetup||n.setup(),n.envelope.gain.setValueAtTime(n.volume,e),n.envelope.gain.exponentialRampToValueAtTime(.1,e+n.pulseWidth),n.envelope.gain.setValueAtTime(n.volume,e+n.pulseWidth),n.envelope.gain.exponentialRampToValueAtTime(.1,e+2*n.pulseWidth),n.envelope.gain.setValueAtTime(n.volume,e+2*n.pulseWidth),n.envelope.gain.exponentialRampToValueAtTime(.001,e+n.decay),n.noise.start(e),n.noise.stop(e+n.decay))},this.setTone=function(e){n.tone=e},this.setVolume=function(e){n.volume=e},this.setFXAmount=function(e){n.fxAmount=e},this.tone=130,this.volume=1,this.decay=.3,this.pulseWidth=.025,this.ctx=t,this.fxAmount=0,this.hasSetup=!1}return Object(ae.a)(e,[{key:"noiseBuffer",value:function(){for(var e=this.ctx.sampleRate,t=this.ctx.createBuffer(1,e,this.ctx.sampleRate),n=t.getChannelData(0),i=0;i<e;i++)n[i]=2*Math.random()-1;return t}},{key:"setup",value:function(){this.noise=this.ctx.createBufferSource(),this.noise.buffer=this.noiseBuffer(),this.filter=this.ctx.createBiquadFilter(),this.filter.type="bandpass",this.filter.frequency.value=2*this.tone,this.envelope=this.ctx.createGain(),this.feedback=this.ctx.createGain(),this.echo=this.ctx.createDelay(),this.feedback.gain.value=.99*this.fxAmount/100,this.noise.connect(this.filter),this.filter.connect(this.envelope),this.envelope.connect(this.echo),this.echo.connect(this.feedback),this.feedback.connect(this.echo),this.feedback.connect(this.ctx.destination),this.envelope.connect(this.ctx.destination),this.hasSetup=!0}}]),e}(),ue=function(){function e(t){var n=this;Object(ie.a)(this,e),this.setTone=function(e){n.tone=e},this.setVolume=function(e){n.volume=e},this.setFXAmount=function(e){n.fxAmount=parseFloat(e)},this.ctx=t,this.ratios=[1,1.342,1.2312,1.6532,1.9523,2.1523],this.tone=130.81,this.decay=1.5,this.volume=1,this.fxAmount=0}return Object(ae.a)(e,[{key:"setup",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.noise=this.ctx.createBufferSource(),this.noise.buffer=this.noiseBuffer(),this.noiseEnvelope=this.ctx.createGain(),this.noiseFilter=this.ctx.createBiquadFilter(),this.noiseFilter.type="highpass",this.noiseFilter.frequency.value=2e3,this.oscEnvelope=this.ctx.createGain(),this.bndPass=this.ctx.createBiquadFilter(),this.bndPass.type="bandpass",this.bndPass.frequency.value=2e4,this.bndPass.Q.value=.2,this.hipass=this.ctx.createBiquadFilter(),this.hipass.type="highpass",this.hipass.frequency.value=5e3,this.noise.connect(this.noiseFilter),this.noiseFilter.connect(this.noiseEnvelope),this.bndPass.connect(this.hipass),this.hipass.connect(this.oscEnvelope),this.noiseEnvelope.connect(this.ctx.destination),this.oscEnvelope.connect(this.ctx.destination);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"noiseBuffer",value:function(){for(var e=this.ctx.sampleRate,t=this.ctx.createBuffer(1,e,this.ctx.sampleRate),n=t.getChannelData(0),i=0;i<e;i++)n[i]=2*Math.random()-1;return t}},{key:"trigger",value:function(e){var t=this;0!==this.volume&&(this.setup(),this.ratios.forEach((function(n){var i=t.ctx.createOscillator();i.type="square",i.frequency.value=t.tone*n,i.connect(t.bndPass),i.start(e),i.stop(e+t.decay)})),this.oscEnvelope.gain.setValueAtTime(1e-5*this.volume,e),this.oscEnvelope.gain.exponentialRampToValueAtTime(1*this.volume,e+.01),this.oscEnvelope.gain.exponentialRampToValueAtTime(.3*this.volume,e+.1*this.decay+this.fxAmount/100),this.oscEnvelope.gain.exponentialRampToValueAtTime(1e-5*this.volume,e+this.decay+this.fxAmount/50))}}]),e}(),le={},he={},pe=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],de=21;de<=108;de++){var fe=pe[de%12]+((de-12)/12>>0);le[fe]=de,he[de]=fe}var me=function(e){return function(t){var n=[];return function(i){if(t(i),"@GRID/SET_MIDI_DEVICES"===i.type&&function(e,t){var i,a=Object(ne.a)(e);try{var o=function(){var e=i.value,a=void 0,o=void 0,r=void 0,c=void 0;-1===n.indexOf(e.id)&&(e.addEventListener("midimessage",(function(e){var n=Object(l.a)(e.data,3),i=n[0],s=n[1],u=n[2],h=F();if(!a){var p=F();(a=new oe(p)).setup(),(o=new ce(p)).setup(),(r=new re(p)).setup(),(c=new se(p)).setup(),new ue(p).setup()}var d={C2:function(){a.trigger(h.currentTime),(a=new oe(h)).setup()},Db2:function(){o.trigger(h.currentTime),(o=new ce(h)).setup()},D2:function(){r.trigger(h.currentTime),(r=new re(h)).setup()},E2:function(){c.trigger(h.currentTime),(c=new se(h)).setup()}};if(144===i&&u>0){t.dispatch(function(e,t,n,i){return{type:"@GRID/TRIGGER_NOTE",payload:{note:e,velocity:t,triggerTime:n,loopStartTime:i}}}(he[s],u,h.currentTime));var f=d[he[s]];f&&f()}})),n.push(e.id))};for(a.s();!(i=a.n()).done;)o()}catch(r){a.e(r)}finally{a.f()}}(i.payload.devices,e),"@GRID/TRIGGER_NOTE"===i.type){var a=i.payload,o=a.note,r=a.triggerTime,c=e.getState().grid,s=c.loopLength,u=c.recordingMidi,h=c.playing,p=function(e){if(u&&h)return function(e,t){return{type:"@GRID/RECORD_MIDI_NOTE",payload:{engine:e,triggerTime:t}}}(e,r)},d={C1:function(){return w()},D1:function(){return{type:"@GRID/TOGGLE_METRONOME"}},E1:function(){return x(s/2)},F1:function(){return x(2*s)},C2:function(){return p(oe)},Db2:function(){return p(ce)},D2:function(){return p(re)},Eb2:function(){return p(ue)},E2:function(){return p(se)}}[o];if(d){var f=d();f&&e.dispatch(f)}else console.log("Unmapped midi note ".concat(o))}}}};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(h.a,{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(J.d)(Z,e,Object(J.a)(ee,te,me))}()},a.a.createElement(H,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[39,1,2]]]);
//# sourceMappingURL=main.f71ae6fe.chunk.js.map